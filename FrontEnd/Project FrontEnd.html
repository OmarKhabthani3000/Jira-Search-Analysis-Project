<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jira Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand d-flex align-items-center" href="#">
                <img src="C:\Users\omark\Documents\GitHub\StagePFE\logo no word.png " alt="Logo" width="40" height="40" class="me-2"> 
                Jira Data
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#overview">Aperçu</a></li>
                    <li class="nav-item"><a class="nav-link" href="#search">Recherche</a></li>
                    <li class="nav-item"><a class="nav-link" href="#dashboard">Dashboard</a></li>
                </ul>
            </div>
        </div>
    </nav>
    <section id="overview" class="container mt-5 fade-in">
        <h1 class="text-center mb-4">Aperçu du Projet</h1>
    
        <div class="row align-items-center mb-5">
            <div class="col-md-5 text-center">
                <img src="C:\Users\omark\Documents\GitHub\StagePFE\logo no bg.png" alt="Logo" width="300" height="300" class="mb-3 prominent-logo rounded hover-grow">
            </div>
            <div class="col-md-7">
                <p class="text-justify project-description">
                    Le projet <strong>Jira Data</strong> est conçu pour fournir une interface utilisateur intuitive afin de rechercher et d'analyser des données issues de Jira. 
                    Il intègre des fonctionnalités avancées comme Elasticsearch pour la recherche et Power BI pour la visualisation des données.
                </p>
            </div>
        </div>
        
        <hr class="section-divider-small">
    
        <div class="row align-items-center mb-4">
            <div class="col-md-4 text-center">
                <img src="C:\Users\omark\Documents\GitHub\StagePFE\elastic logo.png" alt="Recherche" 
                     width="150" height="150" class="rounded hover-grow" 
                     onclick="scrollToSection('search')">
            </div>
            <div class="col-md-8">
                <p class="text-justify">
                    La <strong>section de recherche</strong> vous permet de trouver rapidement des problèmes spécifiques grâce à des critères tels que le résumé, la description, la clé de projet et le type de problème.
                </p>
            </div>
        </div>
        
        <hr class="section-divider-small">
    
        <div class="row align-items-center mb-4">
            <div class="col-md-4 text-center">
                <img src="C:\Users\omark\Documents\GitHub\StagePFE\powerbi logo.svg" alt="Dashboard" 
                     width="150" height="150" class="rounded hover-grow" 
                     onclick="scrollToSection('dashboard')">
            </div>
            <div class="col-md-8">
                <p class="text-justify">
                    Le <strong>Dashboard Power BI</strong> offre une visualisation complète des données projetées, vous permettant de surveiller et d’analyser les métriques clés.
                </p>
            </div>
        </div>
    </section>
    <hr class="section-divider">

    <section id="search" class="container mt-5 fade-in">
        <h1 class="text-center mb-4">Recherche Elasticsearch</h1>

        <form id="searchForm" class="border p-4 rounded bg-light shadow-sm mb-5">
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="querySummary" class="form-label">Résumé de l'Issue:</label>
                    <input type="text" id="querySummary" name="querySummary" class="form-control" placeholder="Entrez un bref résumé de l'Issue">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="queryDescription" class="form-label">Description de l'Issue:</label>
                    <input type="text" id="queryDescription" name="queryDescription" class="form-control" placeholder="Entrez une description détaillée de l'Issue">
                </div>
            </div>
            <div class="row">
                <div class="col-md-6 mb-3">
                    <label for="projectKey" class="form-label">Clé du Projet:</label>
                    <input type="text" id="projectKey" name="projectKey" class="form-control" placeholder="Entrez la clé du projet associé à l'Issue">
                </div>
                <div class="col-md-6 mb-3">
                    <label for="issueType" class="form-label">Type de l'Issue:</label>
                    <input type="text" id="issueType" name="issueType" class="form-control" placeholder="Entez le type de l'Issue (optionnel)">
                </div>
            </div>
            <button type="button" class="btn btn-primary w-100" onclick="searchIssues()">
                <i class="fas fa-search"></i> Rechercher
            </button>
        </form>

        <div id="alertArea" class="mt-3"></div>

        <div class="accordion mt-5 mb-5" id="resultsAccordion">
    </section>

    <hr class="section-divider">

    <section id="dashboard" class="container-fluid px-0 fade-in">
            <h1 class="text-center mb-4">Dashboard Power BI</h1>
            <div class="d-flex justify-content-center">
                <iframe
                    src="https://app.powerbi.com/reportEmbed?reportId=d2fb6f1c-86b4-43d9-860c-9ba6548d45aa&autoAuth=true&ctid=604f1a96-cbe8-43f8-abbf-f8eaf5d85730"
                    frameborder="0"
                    allowFullScreen="true"
                    class="rounded border dashboard-iframe">
                </iframe>
             </div>
    </section>

    <footer class="bg-dark text-white text-center py-3 mt-5">
        <p>&copy; 2024 Jira Data. Tous droits réservés.</p>
    </footer>
    <script>
        async function searchIssues() {
            const formData = {
                query_summary: document.getElementById('querySummary').value,
                query_description: document.getElementById('queryDescription').value,
                project_key: document.getElementById('projectKey').value,
                issue_type: document.getElementById('issueType').value
            };

            try {
                const response = await fetch('http://127.0.0.1:5000/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.statusText}`);
                }

                const data = await response.text();

                populateAccordion(data);

                showAlert("Recherche terminée avec succès !", "success");
            } catch (error) {
                console.error("Erreur lors de la récupération des résultats de recherche :", error);

                showAlert("Une erreur s'est produite lors de la récupération des résultats. Veuillez réessayer.", "danger");
            }
        }


        function showAlert(message, type) {
            const alertArea = document.getElementById('alertArea');
            alertArea.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
            `;
        }

        function populateAccordion(results) {
            const accordion = document.getElementById('resultsAccordion');
            accordion.innerHTML = ''; 

            results.split("----------------------------------------").forEach((result, index) => {
                if (result.trim()) {
                    accordion.innerHTML += `
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="heading${index}">
                                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapse${index}" aria-expanded="false" aria-controls="collapse${index}">
                                    Top ${index + 1} Issue
                                </button>
                            </h2>
                            <div id="collapse${index}" class="accordion-collapse collapse" aria-labelledby="heading${index}" data-bs-parent="#resultsAccordion">
                                <div class="accordion-body">
                                    <pre>${result.trim()}</pre>
                                </div>
                            </div>
                        </div>
                    `;
                }
            });
        }

        document.addEventListener('scroll', () => {
            const sections = document.querySelectorAll('section'); 
            const navLinks = document.querySelectorAll('.nav-link');

            let activeIndex = -1;

            sections.forEach((section, index) => {
                const rect = section.getBoundingClientRect();
                if (rect.top <= window.innerHeight / 2 && rect.bottom >= window.innerHeight / 2) {
                    activeIndex = index;
                }
            });

            
            navLinks.forEach((link, index) => {
                if (index === activeIndex) {
                    link.classList.add('active');
                } else {
                    link.classList.remove('active');
                }
            });
        });

        document.querySelectorAll('.nav-link').forEach(link => {
        link.addEventListener('click', event => {
        event.preventDefault();
        const targetId = link.getAttribute('href').substring(1); 
        document.getElementById(targetId).scrollIntoView({ behavior: 'smooth' }); 
             });
        });

        document.addEventListener('scroll', () => {
            document.querySelectorAll('.fade-in').forEach(element => {
                const rect = element.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    element.classList.add('visible');
                }
            });
        });


        document.addEventListener('DOMContentLoaded', () => {
            document.querySelectorAll('.fade-in').forEach(element => {
                const rect = element.getBoundingClientRect();
                if (rect.top < window.innerHeight && rect.bottom > 0) {
                    element.classList.add('visible');
                }
            });
        });

        function scrollToSection(sectionId) {
        const target = document.getElementById(sectionId);
        target.scrollIntoView({ behavior: 'smooth' });
        }

    </script>
</body>
</html>
