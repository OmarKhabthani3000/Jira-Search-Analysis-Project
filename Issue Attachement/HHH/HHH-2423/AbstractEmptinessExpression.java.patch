diff U3 C:/Documents and Settings/Tsuyoshi Goto/My Documents/temp/BackUP/AbstractEmptinessExpression.java C:/Documents and Settings/Tsuyoshi Goto/My Documents/temp/Fix/AbstractEmptinessExpression.java
--- C:/Documents and Settings/Tsuyoshi Goto/My Documents/temp/BackUP/AbstractEmptinessExpression.java	Thu May 31 19:24:08 2007
+++ C:/Documents and Settings/Tsuyoshi Goto/My Documents/temp/Fix/AbstractEmptinessExpression.java	Thu Jul 12 02:03:24 2007
@@ -7,6 +7,7 @@
 import org.hibernate.QueryException;
 import org.hibernate.engine.SessionFactoryImplementor;
 import org.hibernate.engine.TypedValue;
+import org.hibernate.persister.collection.OneToManyPersister;
 import org.hibernate.persister.collection.QueryableCollection;
 import org.hibernate.persister.entity.Loadable;
 import org.hibernate.persister.entity.PropertyMapping;
@@ -38,13 +39,20 @@
 
 		SessionFactoryImplementor factory = criteriaQuery.getFactory();
 		QueryableCollection collectionPersister = getQueryableCollection( entityName, actualPropertyName, factory );
-
+		
+		//this is for the fix of HHH-2423
+		String whereClauseIfThereAre = "";
+		if(collectionPersister instanceof OneToManyPersister && collectionPersister.hasWhere()){
+				whereClauseIfThereAre = " and " + ((OneToManyPersister)collectionPersister).getSqlWhereString();
+		}	
+		
 		String[] collectionKeys = collectionPersister.getKeyColumnNames();
 		String[] ownerKeys = ( ( Loadable ) factory.getEntityPersister( entityName ) ).getIdentifierColumnNames();
 
 		String innerSelect = "(select 1 from " + collectionPersister.getTableName()
 		        + " where "
 		        + new ConditionFragment().setTableAlias( sqlAlias ).setCondition( ownerKeys, collectionKeys ).toFragmentString()
+		        + whereClauseIfThereAre //XXX  
 		        + ")";
 
 		return excludeEmpty()
