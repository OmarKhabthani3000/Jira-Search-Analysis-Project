-- QueryCriteria Builder

CriteriaBuilder cb = em.getCriteriaBuilder();
CriteriaQuery<Long> cq = cb.createQuery(Long.class);    
Root<Sale> from = cq.from(Sale.class);
Expression<Long> count = cb.countDistinct(from);
cq.select(count);
... some criterias here ...
TypedQuery<Long> typedQuery = em.createQuery(cq);
Long transactionsCount = typedQuery.getSingleResult();


-- 2008Dialect

WITH query AS (
select ROW_NUMBER() OVER (ORDER BY CURRENT_TIMESTAMP) as __hibernate_row_nr__,
	count(sale0_.id) as col_0_0_ 
from
	vas.sale sale0_ cross 
join
	vas.package package1_ cross 
join
	vas.service service2_ cross 
join
	vas.country country4_ 
where
	sale0_.package=package1_.id 
	and package1_.service=service2_.id 
	and package1_.country=country4_.id 
	and service2_.content_provider=? 
	and (country4_.code in (?)) 
	and (package1_.service in (1)) 
	and sale0_.date>=? 
	and sale0_.date<? 
group by
	count(sale0_.id)
)

SELECT
	* 
FROM
	query 
WHERE
	__hibernate_row_nr__ BETWEEN ? AND ?


-- OldDialect

     select
         top 2 count(distinct sale0_.id) as col_0_0_ 
     from
         vas.sale sale0_ cross 
     join
         vas.package package1_ cross 
     join
         vas.service service2_ cross 
     join
         vas.country country4_ 
     where
         sale0_.package=package1_.id 
         and package1_.service=service2_.id 
         and package1_.country=country4_.id 
         and service2_.content_provider=? 
         and (
             country4_.code in (
                 ?
             )
         ) 
         and (
             package1_.service in (
                 1
             )
         ) 
         and sale0_.date>=? 
         and sale0_.date<?

