41c41
< 
---
> 	private static final String[] AGGREGATE_FUNCTION_NAMES=new String[]{"avg","count","min","sum","max"}; 
147a148
> 		
149,150c150,164
< 			sql.delete(distinctIndex, distinctIndex + DISTINCT.length() + 1);
< 			sql.append(" group by").append(getSelectFieldsWithoutAliases(sql));
---
> 			String selectFieldsWithoutAlias=getSelectFieldsWithoutAliases(sql).toString();
> 			boolean aggregateFunctionAvailable=false;
> 			for(String functionName : AGGREGATE_FUNCTION_NAMES)
> 			{
> 				if(selectFieldsWithoutAlias.indexOf(functionName)>0)
> 				{
> 					aggregateFunctionAvailable=true;
> 					break;
> 				}
> 			}
> 			if(!aggregateFunctionAvailable)
> 			{
> 				sql.delete(distinctIndex, distinctIndex + DISTINCT.length() + 1);
> 				sql.append(" group by").append(getSelectFieldsWithoutAliases(sql));
> 			}

