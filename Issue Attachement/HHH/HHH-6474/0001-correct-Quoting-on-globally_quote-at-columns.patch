From fa7fb728cd4f8d5c78a61568182a4544d65eed56 Mon Sep 17 00:00:00 2001
From: Werner Schneider <werner@schneidernet.com>
Date: Tue, 14 Jun 2011 05:51:04 +0200
Subject: [PATCH] correct Quoting on globally_quote at columns

---
 .../src/main/java/org/hibernate/cfg/HbmBinder.java |   10 +++++++---
 1 files changed, 7 insertions(+), 3 deletions(-)

diff --git a/hibernate-core/src/main/java/org/hibernate/cfg/HbmBinder.java b/hibernate-core/src/main/java/org/hibernate/cfg/HbmBinder.java
index 473fc0b..461aff8 100644
--- a/hibernate-core/src/main/java/org/hibernate/cfg/HbmBinder.java
+++ b/hibernate-core/src/main/java/org/hibernate/cfg/HbmBinder.java
@@ -1092,10 +1092,11 @@ public final class HbmBinder {
 					column.setValue( simpleValue );
 					column.setTypeIndex( count++ );
 					bindColumn( columnElement, column, isNullable );
-					final String columnName = columnElement.attributeValue( "name" );
+					String columnName = columnElement.attributeValue( "name" );
 					String logicalColumnName = mappings.getNamingStrategy().logicalColumnName(
 							columnName, propertyPath
 					);
+					columnName = mappings.getObjectNameNormalizer().normalizeIdentifierQuoting( columnName );
 					column.setName( mappings.getNamingStrategy().columnName(
 						columnName ) );
 					if ( table != null ) {
@@ -1147,10 +1148,11 @@ public final class HbmBinder {
 			if ( column.isUnique() && ManyToOne.class.isInstance( simpleValue ) ) {
 				( (ManyToOne) simpleValue ).markAsLogicalOneToOne();
 			}
-			final String columnName = columnAttribute.getValue();
+			String columnName = columnAttribute.getValue();
 			String logicalColumnName = mappings.getNamingStrategy().logicalColumnName(
 					columnName, propertyPath
 			);
+			columnName = mappings.getObjectNameNormalizer().normalizeIdentifierQuoting( columnName );			
 			column.setName( mappings.getNamingStrategy().columnName( columnName ) );
 			if ( table != null ) {
 				table.addColumn( column ); // table=null -> an association - fill
@@ -1167,7 +1169,9 @@ public final class HbmBinder {
 			Column column = new Column();
 			column.setValue( simpleValue );
 			bindColumn( node, column, isNullable );
-			column.setName( mappings.getNamingStrategy().propertyToColumnName( propertyPath ) );
+			String columnName = mappings.getNamingStrategy().propertyToColumnName( propertyPath );
+			columnName = mappings.getObjectNameNormalizer().normalizeIdentifierQuoting( columnName );
+			column.setName( columnName );
 			String logicalName = mappings.getNamingStrategy().logicalColumnName( null, propertyPath );
 			mappings.addColumnBinding( logicalName, column, table );
 			/* TODO: joinKeyColumnName & foreignKeyColumnName should be called either here or at a
-- 
1.7.4.1

