### Eclipse Workspace Patch 1.0
#P hibernate_trunk
Index: core/src/main/java/org/hibernate/collection/PersistentSet.java
===================================================================
--- core/src/main/java/org/hibernate/collection/PersistentSet.java	(revision 18810)
+++ core/src/main/java/org/hibernate/collection/PersistentSet.java	(working copy)
@@ -376,14 +376,27 @@
 		Type elementType = persister.getElementType();
 		final java.util.Map sn = (java.util.Map) getSnapshot();
 		ArrayList deletes = new ArrayList( sn.size() );
+		
 		Iterator iter = sn.keySet().iterator();
 		while ( iter.hasNext() ) {
-			Object test = iter.next();
-			if ( !set.contains(test) ) {
+			boolean found = false;
+			Object testOuter = iter.next();
+			Iterator inner = set.iterator();
+			
+		    do {
+		        Object testInner = inner.next();
+		        if (testOuter.equals(testInner) || testInner.equals(testOuter)) {
+		            found = true;
+		            break;
+		        }
+		    } while (inner.hasNext());
+
+			if ( !found) { 
 				// the element has been removed from the set
-				deletes.add(test);
+				deletes.add(testOuter);
 			}
 		}
+		
 		iter = set.iterator();
 		while ( iter.hasNext() ) {
 			Object test = iter.next();
