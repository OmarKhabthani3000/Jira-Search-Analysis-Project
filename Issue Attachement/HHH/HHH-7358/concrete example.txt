Example:

Java code:
forRevision = 2024712; // sample
getAuditReader().createQuery().forEntitiesAtRevision(AeroRepart.class, forRevision)
                    .add(AuditEntity.property("an").maximize()).getResultList();

Generated SQL:
/* select e from AeroRepart_AUD e where e.originalId.REV.id <= :revision and e.REV_TYPE <> :_p0 and e.an = (select max(_e0.an) from AeroRepart_AUD _e0) and (e.REV_TO.id > :revision or e.REV_TO is null) */ select aerorepart0_.id as id115_, aerorepart0_.REV as REV115_, aerorepart0_.REV_TYPE as REV3_115_, aerorepart0_.REV_TO as REV4_115_, aerorepart0_.AltiEAero as AltiEAero115_, aerorepart0_.An as An115_, aerorepart0_.CodeCant as CodeCant115_, aerorepart0_.NoAero as NoAero115_, aerorepart0_.NoHa as NoHa115_, aerorepart0_.RepartExploitation as RepartE10_115_, aerorepart0_.RepartLTOAlti1 as RepartL11_115_, aerorepart0_.RepartLTOAlti2 as RepartL12_115_, aerorepart0_.RepartLTODeco1 as RepartL13_115_, aerorepart0_.RepartLTODeco2 as RepartL14_115_, aerorepart0_.RepartLTOSol1 as RepartL15_115_, aerorepart0_.RepartLTOSol2 as RepartL16_115_ from AeroRepart_AUD aerorepart0_ where aerorepart0_.REV<=? and aerorepart0_.REV_TYPE<>? and aerorepart0_.An=(select max(aerorepart1_.An) from AeroRepart_AUD aerorepart1_) and (aerorepart0_.REV_TO>? or aerorepart0_.REV_TO is null)


Problem:
The "select max(_e0.an) from AeroRepart_AUD _e0" subquery do not contain filtering on revision ["e.originalId.REV.id <= :revision and e.REV_TYPE <> :_p0" and "and (e.REV_TO.id > :revision or e.REV_TO is null)"].


Workaround:
Use 2 queries
 a) select the max value
 b) run the query using the previous value

 
Expected behaviour:
The use of forEntitiesAtRevision() automatically adds the same filter to all subqueries (caused by maximize() or minimize()).
