38,41d37
< 		if ( sql.toLowerCase().endsWith(" for update") ) {
< 			sql = sql.substring( 0, sql.length()-11 );
< 			isForUpdate = true;
< 		}
43,49c39,40
< 		StringBuffer pagingSelect = new StringBuffer( sql.length()+100 );
< 		if (hasOffset) {
< 			pagingSelect.append("select * from ( select row_.*, rownum rownum_ from ( ");
< 		}
< 		else {
< 			pagingSelect.append("select * from ( ");
< 		}
---
> 		StringBuffer pagingSelect = new StringBuffer( sql.length()+121 );
> 		pagingSelect.append("select * from ( select /*+ FIRST_ROWS(n) */ row_.*, rownum rownum_ from ( ");
50a42,46
> 		
> 		if (pagingSelect.substring( pagingSelect.length()-11 ).equalsIgnoreCase(" for update")){
> 			pagingSelect.setLength( pagingSelect.length()-11 );
> 			isForUpdate = true;
> 		}
55c51
< 			pagingSelect.append(" ) where rownum <= ?");
---
> 			pagingSelect.append(" ) row_ where rownum <= ?) where rownum_ > 0");
