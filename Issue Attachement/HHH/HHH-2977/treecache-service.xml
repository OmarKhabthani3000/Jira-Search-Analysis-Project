<?xml version="1.0" encoding="UTF-8"?>

<!-- ===================================================================== -->
<!--                                                                       -->
<!--  Sample TreeCache Service Configuration                               -->
<!--  Recommended for use as Hibernate's 2nd Level Cache                   -->
<!--  For use with JBossCache >= 1.3.0 ONLY!!!                             -->
<!--                                                                       -->
<!-- ===================================================================== -->

<server>
	
	<classpath codebase="./lib" archives="jboss-cache-1.4.1.SP4.jar, jgroups-all-2.4.1.jar"/>
	
	
	<!-- ==================================================================== -->
	<!-- Defines TreeCache configuration                                      -->
	<!-- ==================================================================== -->
	
	<mbean code="org.jboss.cache.TreeCache"
	       name="jboss.cache:service=HibernateTreeCache">
		
		<depends>jboss:service=Naming</depends>
		<depends>jboss:service=TransactionManager</depends>
		
		<!--
		    Configure the TransactionManager
		    -->
		<attribute name="TransactionManagerLookupClass">org.jboss.cache.GenericTransactionManagerLookup</attribute>
		
		
		<!--
		    Node locking scheme:
		    OPTIMISTIC
		    PESSIMISTIC (default)
		    -->
		<attribute name="NodeLockingScheme">PESSIMISTIC</attribute>
		
		<!--
		    Note that this attribute is IGNORED if your NodeLockingScheme above is OPTIMISTIC.
		    
		    Isolation level : SERIALIZABLE
		    REPEATABLE_READ (default)
		    READ_COMMITTED
		    READ_UNCOMMITTED
		    NONE
		    -->
		<attribute name="IsolationLevel">READ_COMMITTED</attribute>
		
		<!--
		    Valid modes are LOCAL
		    REPL_ASYNC
		    REPL_SYNC
		    INVALIDATION_ASYNC
		    INVALIDATION_SYNC
		    -->
		
		<!-- This should ideally be set to INVALIDATION_ASYNC but due to JBCACHE-806 this has to be REPL_ASYNC for now -->
		<attribute name="CacheMode">LOCAL</attribute>
		
		<!--<attribute name="lockParentForChildInsertRemove">true</attribute>-->
		<!--
		    Just used for async repl: use a replication queue
		    -->
		<attribute name="UseReplQueue">false</attribute>
		
		<!--
		    Replication interval for replication queue (in ms)
		    -->
		<attribute name="ReplQueueInterval">0</attribute>
		
		<!--
		    Max number of elements which trigger replication
		    -->
		<attribute name="ReplQueueMaxElements">0</attribute>
		
		<!-- Name of cluster. Needs to be the same for all clusters, in order
		     to find each other
		     -->
		<attribute name="ClusterName">TreeCache-IPTVMW-Cluster</attribute>
		
		<!-- JGroups protocol stack properties. Can also be a URL,
		     e.g. file:/home/bela/default.xml
		     <attribute name="ClusterProperties"></attribute>
		     -->
		     
		     <attribute name="ClusterConfig">
			     <config>
				     <!--  <UDP mcast_addr="224.0.0.98" mcast_port="48848"
						ip_ttl="64" ip_mcast="true" 
						mcast_send_buf_size="150000" mcast_recv_buf_size="80000"
						ucast_send_buf_size="150000" ucast_recv_buf_size="80000"
						loopback="false"/>
				     <PING timeout="2000" num_initial_members="3"
					   up_thread="false" down_thread="false"/>
				     <MERGE2 min_interval="10000" max_interval="20000"/>
				     <FD_SOCK/>
				     <VERIFY_SUSPECT timeout="1500"
						     up_thread="false" down_thread="false"/>
				     <pbcast.NAKACK gc_lag="50" retransmit_timeout="600,1200,2400,4800"
						    max_xmit_size="8192" up_thread="false" down_thread="false"/>
				     <UNICAST timeout="600,1200,2400" window_size="100" min_threshold="10"
					      down_thread="false"/>
				     <pbcast.STABLE desired_avg_gossip="20000"
						    up_thread="false" down_thread="false"/>
				     <FRAG frag_size="8192"
					   down_thread="false" up_thread="false"/>
				     <pbcast.GMS join_timeout="5000" join_retry_timeout="2000"
						 shun="true" print_local_addr="true"/>
				     <pbcast.STATE_TRANSFER up_thread="true" down_thread="true"/>-->
				     
				     <TCP start_port="27910" bind_addr="1.1.1.1"/>  
				     <TCPPING initial_hosts="127.0.0.1[27910]" port_range="5" timeout="3000" num_initial_members="1" up_thread="true" down_thread="true"/>  
				     <FD shun="true" up_thread="true" down_thread="true" timeout="2500" max_tries="5" />  
				     <VERIFY_SUSPECT timeout="1500" up_thread="false" down_thread="false" />  
				     <pbcast.NAKACK gc_lag="100" retransmit_timeout="3000" up_thread="true" down_thread="true" />  
				     <pbcast.STABLE desired_avg_gossip="20000" up_thread="false" down_thread="false" />  
				     <pbcast.GMS join_timeout="5000" join_retry_timeout="2000" shun="false" print_local_addr="false" down_thread="true" up_thread="true" />  
				     <pbcast.STATE_TRANSFER up_thread="true" down_thread="true"/>  
			     </config>
		     </attribute>
		     
		     <!--
			 Whether or not to fetch state on joining a cluster
			 NOTE this used to be called FetchStateOnStartup and has been renamed to be more descriptive.
			 -->
		     <attribute name="FetchInMemoryState">false</attribute>
		     
		     <!--
			 Number of milliseconds to wait until all responses for a
			 synchronous call have been received.
			 -->
		     <attribute name="SyncReplTimeout">20000</attribute>
		     
		     <!-- Max number of milliseconds to wait for a lock acquisition -->
		     <attribute name="LockAcquisitionTimeout">15000</attribute>
		     
		     <!--
			 The max amount of time (in milliseconds) we wait until the
			 initial state (ie. the contents of the cache) are retrieved from
			 existing members in a clustered environment
			 -->
		     <attribute name="InitialStateRetrievalTimeout">20000</attribute>
		     
		     <!-- Name of the eviction policy class. -->
		     <attribute name="EvictionPolicyClass"></attribute>
		     
		     <!--
			 Indicate whether to use region based marshalling or not. Set this to true if you are running under a scoped
			 class loader, e.g., inside an application server. Default is "false".
			 -->
		     <attribute name="UseRegionBasedMarshalling">false</attribute>
		     
		     <!--  Specific eviction policy configurations. This is LRU -->
		     <attribute name="EvictionPolicyConfig">
			     <config>
				     <attribute name="wakeUpIntervalSeconds">5</attribute>
				     <!--  Cache wide default -->
				     <region name="/_default_">
					     <attribute name="maxNodes">1000000</attribute>					     
				     </region>				     
			     </mbean>
		     </server>
