<?xml version="1.0"?>
<!DOCTYPE hibernate-mapping PUBLIC
    "-//Hibernate/Hibernate Mapping DTD 2.0//EN"
    "http://hibernate.sourceforge.net/hibernate-mapping-2.0.dtd" >

<hibernate-mapping>
    <class name="it.esselunga.ecommerce.data.model.Party" table="PARTY" lazy="true" >
        <meta attribute="class-description" inherit="false">
       @hibernate.class table="PARTY" lazy="true"
        </meta>
        <meta attribute="implement-equals">true</meta>

        <id name="partyId" type="int" column="PARTY_ID">
            <meta attribute="field-description">
           @hibernate.id generator-class="sequence" type="int" column="PARTY_ID"
           @hibernate.generator-param name="sequence" value="PARTY_SEQ"
            </meta>
            <generator class="sequence">
                <param name="sequence">PARTY_SEQ</param>
            </generator>
        </id>

        <property name="partyType" type="it.esselunga.ecommerce.data.model.PartyType" column="PARTY_TYPE">
            <meta attribute="field-description">
           @hibernate.property column="PARTY_TYPE"
            </meta>
        </property>

        <!-- bi-directional many-to-many association to Party through composite element containing attributes-->
        <set name="relatedPartiesFrom" lazy="true" table="PARTY_RELATIONSHIP">
            <meta attribute="field-description">
           @hibernate.set lazy="true" table="PARTY_RELATIONSHIP"
	       @hibernate.collection-key column="PARTY_ID_TO"
           @hibernate.collection-composite-element class="it.esselunga.ecommerce.data.model.PartyRelationship"
            </meta>
            <key column="PARTY_ID_TO"/>
            <composite-element class="it.esselunga.ecommerce.data.model.PartyRelationship">
                <property name="fromDate" column="FROM_DATE" type="java.sql.Timestamp" />
                <property name="throughDate" column="THRU_DATE" type="java.sql.Timestamp" />
                <property name="description" column="DESCRIPTION" type="java.lang.String" length="100" />
                <many-to-one name="relationshipType" class="it.esselunga.ecommerce.data.model.PartyRelationshipType">
                    <meta attribute="field-description">
                   @hibernate.many-to-one not-null="true" class="it.esselunga.ecommerce.data.model.PartyRelationshipType"
                   @hibernate.column name="RELATIONSHIP_TYPE_ID"
                    </meta>
                    <column name="RELATIONSHIP_TYPE_ID"/>
                </many-to-one>
                <many-to-one name="relatedParty" class="it.esselunga.ecommerce.data.model.Party" column="PARTY_ID_FROM">
                    <meta attribute="use-in-equals">true</meta>
                </many-to-one>
            </composite-element>
        </set>

        <!-- bi-directional many-to-many association to Party -->
        <set name="relatedPartiesTo" lazy="true" inverse="true" table="PARTY_RELATIONSHIP">
            <meta attribute="field-description">
           @hibernate.set lazy="true" table="PARTY_RELATIONSHIP"
	       @hibernate.collection-key column="PARTY_ID_FROM"
           @hibernate.collection-composite-element class="it.esselunga.ecommerce.data.model.PartyRelationship"
            </meta>
            <key column="PARTY_ID_FROM"/>
            <composite-element class="it.esselunga.ecommerce.data.model.PartyRelationship">
                <property name="fromDate" column="FROM_DATE" type="java.sql.Timestamp" />
                <property name="throughDate" column="THRU_DATE" type="java.sql.Timestamp" />
                <property name="description" column="DESCRIPTION" type="java.lang.String" length="100" />
                <many-to-one name="relationshipType" class="it.esselunga.ecommerce.data.model.PartyRelationshipType">
                    <meta attribute="field-description">
                   @hibernate.many-to-one not-null="true" class="it.esselunga.ecommerce.data.model.PartyRelationshipType"
                   @hibernate.column name="RELATIONSHIP_TYPE_ID"
                    </meta>
                    <column name="RELATIONSHIP_TYPE_ID"/>
                </many-to-one>
                <many-to-one name="relatedParty" class="it.esselunga.ecommerce.data.model.Party" column="PARTY_ID_TO">
                    <meta attribute="use-in-equals">true</meta>
                </many-to-one>
            </composite-element>
        </set>

        <!-- Person is a Party subclass -->
        <!-- todo: chiedersi se lazy="true"  puo' avere utilita' per le sottoclassi -->
        <joined-subclass name="it.esselunga.ecommerce.data.model.Person" table="PERSON" lazy="true">
            <meta attribute="class-description">
           @hibernate.joined-subclass table="PERSON" lazy="true"
            </meta>
            <meta attribute="implement-equals">false</meta>

            <key column="PARTY_ID"/>
            <property name="title" type="java.lang.String" column="TITLE" length="8">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="TITLE" length="8"
                </meta>
            </property>
            <property name="surname" type="java.lang.String" column="SURNAME" length="32">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="SURNAME" length="32"
                </meta>
            </property>
            <property name="forename" type="java.lang.String" column="FORENAME" length="32">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="FORENAME" length="32"
                </meta>
            </property>
            <property name="email" type="java.lang.String" column="EMAIL" length="64">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="EMAIL" length="64"
                </meta>
            </property>
            <property name="homeTel" type="java.lang.String" column="HOME_TEL" length="20">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="HOME_TEL" length="20"
                </meta>
            </property>
            <property name="workTel" type="java.lang.String" column="WORK_TEL" length="20">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="WORK_TEL" length="20"
                </meta>
            </property>
            <property name="mobileTel" type="java.lang.String" column="MOBILE_TEL" length="20">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="MOBILE_TEL" length="20"
                </meta>
            </property>
            <property name="dateOfBirth" type="java.sql.Timestamp" column="DATE_OF_BIRTH" length="7">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="DATE_OF_BIRTH" length="7"
                </meta>
            </property>
            <property name="sex" type="java.lang.String" column="SEX" length="10">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="SEX" length="10"
                </meta>
            </property>
            <property name="detailsPrivate" type="boolean" column="DETAILS_PRIVATE" length="22">
                <meta attribute="field-description">
               @hibernate.property column="DETAILS_PRIVATE" length="22"
                </meta>
            </property>
            <property name="creationDate" type="java.sql.Timestamp" column="CREATION_DATE" length="7">
                <meta attribute="field-description">
               @hibernate.property column="CREATION_DATE" length="7"
                </meta>
            </property>
            <!-- property name="customerType" type="int" column="CUSTOMER_TYPE" length="22">
                <meta attribute="field-description">
               @hibernate.property column="CUSTOMER_TYPE" length="22"
                </meta>
            </property -->

            <!-- bidirectional one-to-many association with the user logins -->
            <set name="userLogins" lazy="true" inverse="true" cascade="all-delete-orphan">
                <meta attribute="field-description">
               @hibernate.set lazy="true" inverse="true"
               @hibernate.collection-key column="PARTY_ID"
               @hibernate.collection-one-to-many class="it.esselunga.ecommerce.data.model.UserLogin"
                </meta>
                <key column="PARTY_ID"/>
                <one-to-many class="it.esselunga.ecommerce.data.model.UserLogin"/>
            </set>
            
            <!-- bi-directional one-to-many association to Trolley -->
		    <set name="trolleys" lazy="true" inverse="true"> <!--??? cascade="all-delete-orphan" -->
	    	    <meta attribute="field-description">
	        	   @hibernate.set lazy="true" inverse="true"
			       @hibernate.collection-key column="PARTY_ID"
				   @hibernate.collection-one-to-many class="it.esselunga.ecommerce.data.model.Trolley"
        		</meta>
	        	<key column="PARTY_ID" />
		        <one-to-many class="it.esselunga.ecommerce.data.model.Trolley" />
		    </set>
            <!-- end of bi-directional one-to-many association to Trolley -->		    

            <!-- bi-directional one-to-many association to ShoppingList -->
		    <set name="shoppingLists" lazy="true" inverse="true" cascade="all-delete-orphan">
	    	    <meta attribute="field-description">
	        	   @hibernate.set lazy="true" inverse="true"
			       @hibernate.collection-key column="PARTY_ID"
				   @hibernate.collection-one-to-many class="it.esselunga.ecommerce.data.model.ShoppingList"
        		</meta>
	        	<key column="PARTY_ID" />
		        <one-to-many class="it.esselunga.ecommerce.data.model.ShoppingList" />
		    </set>
            <!-- end of bi-directional one-to-many association to ShoppingList -->		    

            <!-- bi-directional one-to-many association to Address -->
            <set name="addresses" lazy="true" cascade="all-delete-orphan" inverse="true">
                <meta attribute="field-description">
               @hibernate.set lazy="true" inverse="true" cascade="all-delete-orphan"
               @hibernate.collection-key column="PARTY_ID"
               @hibernate.collection-one-to-many class="it.esselunga.ecommerce.data.model.Address"
                </meta>
                <key column="PARTY_ID"/>
                <one-to-many class="it.esselunga.ecommerce.data.model.Address"/>
            </set>

            <!-- bi-directional many-to-one association to Enumeration -->
            <many-to-one name="profession" class="it.esselunga.ecommerce.data.model.Profession">
                <meta attribute="field-description">
               @hibernate.many-to-one not-null="true" class="it.esselunga.ecommerce.data.model.Profession"
               @hibernate.column name="PROFESSION_ID"
                </meta>
                <column name="PROFESSION_ID"/>
            </many-to-one>

            <!-- bi-directional many-to-one association to Enumeration -->
            <many-to-one name="educationLevel" class="it.esselunga.ecommerce.data.model.EducationLevel">
                <meta attribute="field-description">
               @hibernate.many-to-one not-null="true" class="it.esselunga.ecommerce.data.model.EducationLevel"
               @hibernate.column name="EDUCATION_LEVEL_ID"
                </meta>
                <column name="EDUCATION_LEVEL_ID"/>
            </many-to-one>

            <!-- Customer is a Person subclass -->
            <!-- todo: chiedersi se lazy="true"  puo' avere utilita' per le sottoclassi -->
            <joined-subclass name="it.esselunga.ecommerce.data.model.Customer" table="CUSTOMER" lazy="true">
                <meta attribute="implement-equals">false</meta>
                <meta attribute="class-description" inherit="false">
               @hibernate.joined-subclass lazy="true" table="CUSTOMER" lazy="true"
                </meta>

                <key column="PARTY_ID"/>
                <property name="fidelityCardType" type="java.lang.String" column="FIDELITY_CARD_TYPE" length="10">
                    <meta attribute="field-description">
                   @hibernate.property column="FIDELITY_CARD_TYPE" length="10"
                    </meta>
                </property>
                <property name="fidelityCardNumber" type="java.lang.String" column="FIDELITY_CARD_NUMBER" length="16">
                    <meta attribute="use-in-tostring">true</meta>
                    <meta attribute="field-description">
                   @hibernate.property column="FIDELITY_CARD_NUMBER" length="16"
                    </meta>
                </property>
                <property name="newCardNumber" type="boolean" column="IS_NEW_CARD_NUMBER" length="1">
                    <meta attribute="field-description">
                   @hibernate.property column="IS_NEW_CARD_NUMBER" length="1"
                    </meta>
                </property>
                <property name="howManyRelatives" type="java.lang.Integer" column="HOW_MANY_RELATIVES" length="2">
                    <meta attribute="use-in-tostring">true</meta>
                    <meta attribute="field-description">
                   @hibernate.property column="HOW_MANY_RELATIVES" length="2"
                    </meta>
                </property>
                <property name="sendInfo" type="boolean" column="SEND_INFO" length="1">
                    <meta attribute="use-in-tostring">true</meta>
                    <meta attribute="field-description">
                   @hibernate.property column="SEND_INFO" length="1"
                    </meta>
                </property>

                <!-- bi-directional one-to-many association to DELIVERY_ADDRESS -->
                <map name="deliveryAddresses" lazy="true" cascade="all-delete-orphan" inverse="true">
                    <meta attribute="use-in-tostring">true</meta>
                    <meta attribute="field-description">
                   @hibernate.map lazy="true" inverse="true" cascade="all-delete-orphan"
                   @hibernate.collection-key column="PARTY_ID"
                   @hibernate.collection-index column="USER_ASSIGNED_NAME"
                   @hibernate.collection-one-to-many class="it.esselunga.ecommerce.data.model.DeliveryAddress"
                    </meta>
                    <key column="PARTY_ID"/>
                    <index column="USER_ASSIGNED_NAME" type="string"/>
                    <one-to-many class="it.esselunga.ecommerce.data.model.DeliveryAddress"/>
                </map>
            </joined-subclass>
        </joined-subclass>

        <!-- PartyGroup is a Party subclass -->
        <joined-subclass name="it.esselunga.ecommerce.data.model.PartyGroup" lazy="true" table="PARTY_GROUP">
            <meta attribute="implement-equals">false</meta>
            <meta attribute="class-description">
           @hibernate.joined-subclass lazy="true" table="PARTY_GROUP"
            </meta>
            <key column="PARTY_ID"/>

            <property name="groupName" type="java.lang.String" column="GROUP_NAME" length="20">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="GROUP_NAME" length="20"
                </meta>
            </property>
            <property name="description" type="java.lang.String" column="DESCRIPTION" length="200">
                <meta attribute="use-in-tostring">true</meta>
                <meta attribute="field-description">
               @hibernate.property column="DESCRIPTION" length="200"
                </meta>
            </property>
        </joined-subclass>
    </class>
</hibernate-mapping>
