Index: Configuration.java
===================================================================
retrieving revision 1.27.2.30
diff -u -r1.27.2.30 Configuration.java
--- Configuration.java	4 Feb 2004 18:56:44 -0000	1.27.2.30
+++ Configuration.java	4 Mar 2004 19:05:52 -0000
@@ -318,6 +318,29 @@
 			throw new MappingException("Error reading resource: " + path, me);
 		}
 	}
+    
+    /**
+     * Read mappings from an application resource trying different classloaders.
+     * This method will try to load the resource first from
+     * Thread.currentThread().getContextClassLoader() and if it is not found 
+     * there will retry from Environment.class.getClassLoader();
+     */
+    public Configuration addResource(String path) throws MappingException {
+        log.info("Mapping resource: " + path);
+        InputStream rsrc = Thread.currentThread().getContextClassLoader().getResourceAsStream(path);
+        if (rsrc==null) {
+            rsrc = Environment.class.getClassLoader().getResourceAsStream(path);
+        }
+        if (rsrc==null) {
+            throw new MappingException("Resource: " + path + " not found");
+        }
+        try {
+            return addInputStream(rsrc);
+        } 
+        catch (MappingException me) {
+            throw new MappingException("Error reading resource: " + path, me);
+        }
+    }
 
 	/**
 	 * Read a mapping from an application resource, using a convention.
@@ -969,12 +992,7 @@
 				Attribute jar = mapElement.attribute("jar");
 				if (rsrc!=null) {
 					log.debug(name + "<-" + rsrc);
-					try {
-						addResource( rsrc.getValue(), Thread.currentThread().getContextClassLoader() );
-					}
-					catch (MappingException me) {
-						addResource( rsrc.getValue(), Environment.class.getClassLoader() );
-					}
+					addResource( rsrc.getValue(), Thread.currentThread().getContextClassLoader() );
 				}
 				else if ( jar!=null ) {
 					log.debug(name + "<-" + jar);
