Index: D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/SetElementTest.java
===================================================================
--- D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/SetElementTest.java	(revision 0)
+++ D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/SetElementTest.java	(revision 0)
@@ -0,0 +1,114 @@
+/*******************************************************************************
+  * Copyright (c) 2007-2008 Red Hat, Inc.
+  * Distributed under license by Red Hat, Inc. All rights reserved.
+  * This program is made available under the terms of the
+  * Eclipse Public License v1.0 which accompanies this distribution,
+  * and is available at http://www.eclipse.org/legal/epl-v10.html
+  *
+  * Contributor:
+  *     Red Hat, Inc. - initial API and implementation
+  ******************************************************************************/
+package org.hibernate.tool.hbm2x.hbm2hbmxml;
+
+import java.io.File;
+import java.util.List;
+
+import junit.framework.Test;
+import junit.framework.TestSuite;
+
+import org.dom4j.Document;
+import org.dom4j.DocumentException;
+import org.dom4j.DocumentHelper;
+import org.dom4j.Element;
+import org.dom4j.XPath;
+import org.dom4j.io.SAXReader;
+import org.hibernate.cfg.Configuration;
+import org.hibernate.tool.NonReflectiveTestCase;
+import org.hibernate.tool.hbm2x.Exporter;
+import org.hibernate.tool.hbm2x.HibernateMappingExporter;
+import org.hibernate.util.DTDEntityResolver;
+
+/**
+ * @author Dmitry Geraskov
+ *
+ */
+public class SetElementTest extends NonReflectiveTestCase {
+	
+	private String mappingFile = "Search.hbm.xml";
+	
+	private Exporter hbmexporter;
+
+	/**
+	 * @param name
+	 */
+	public SetElementTest(String name) {
+		super(name, "cfg2hbmoutput");
+	}
+
+	@Override
+	protected String[] getMappings() {
+		return new String[] {
+				mappingFile
+		};
+	}
+	
+	protected void setUp() throws Exception {
+		super.setUp();
+		
+		hbmexporter = new HibernateMappingExporter(getCfg(), getOutputDir() );
+		hbmexporter.start();		
+	}
+	
+	public void testAllFilesExistence() {
+		assertFalse(new File(getOutputDir().getAbsolutePath() + "/GeneralHbmSettings.hbm.xml").exists() );
+		assertFileAndExists(new File(getOutputDir().getAbsolutePath() + getBaseForMappings() + mappingFile) );	
+	}
+	
+	public void testReadable() {
+        Configuration cfg = new Configuration();
+        
+        cfg.addFile(new File(getOutputDir(), getBaseForMappings() + mappingFile));
+        
+        cfg.buildMappings();
+        
+    }
+	
+	public void testSetElement() throws DocumentException {
+		File outputXml = new File(getOutputDir(),  getBaseForMappings() + mappingFile);
+		assertFileAndExists(outputXml);
+
+		SAXReader xmlReader =  this.getSAXReader();
+		
+		Document document = xmlReader.read(outputXml);		
+	
+		XPath xpath = DocumentHelper.createXPath("//hibernate-mapping/class/set");
+		List list = xpath.selectNodes(document);
+		assertEquals("Expected to get one set element", 1, list.size());
+		Element node = (Element) list.get(0);
+		assertEquals(node.attribute( "name" ).getText(),"searchResults");
+		
+		
+		xpath = DocumentHelper.createXPath("//hibernate-mapping/class/set/element");
+		list = xpath.selectNodes(document);
+		assertEquals("Expected to get one element \'element\'", 1, list.size());
+		node = (Element) list.get(0);
+		assertEquals(node.attribute( "column" ).getText(),"text");		
+	}
+	
+	
+    private SAXReader getSAXReader() {
+    	SAXReader xmlReader = new SAXReader();
+    	xmlReader.setEntityResolver(new DTDEntityResolver() );
+    	xmlReader.setValidation(true);
+    	return xmlReader;
+    }
+	
+	protected String getBaseForMappings() {
+		return "org/hibernate/tool/hbm2x/hbm2hbmxml/";
+	}
+	
+	public static Test suite() {
+		return new TestSuite(SetElementTest.class);
+	}
+
+}

Property changes on: D:\workspaces\hibernate-ganymede\HibernateExt\tools\src\test\org\hibernate\tool\hbm2x\hbm2hbmxml\SetElementTest.java
___________________________________________________________________
Name: svn:mime-type
   + text/plain
Name: svn:keywords
   + Author Id Revision Date
Name: svn:eol-style
   + native

Index: D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/Search.java
===================================================================
--- D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/Search.java	(revision 0)
+++ D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/Search.java	(revision 0)
@@ -0,0 +1,29 @@
+//$Id$
+package org.hibernate.tool.hbm2x.hbm2hbmxml;
+
+import java.util.SortedSet;
+import java.util.TreeSet;
+
+public class Search {
+	private String searchString;
+	private SortedSet searchResults = new TreeSet();
+	
+	Search() {}
+	
+	public Search(String string) {
+		searchString = string;
+	}
+	
+	public SortedSet getSearchResults() {
+		return searchResults;
+	}
+	public void setSearchResults(SortedSet searchResults) {
+		this.searchResults = searchResults;
+	}
+	public String getSearchString() {
+		return searchString;
+	}
+	public void setSearchString(String searchString) {
+		this.searchString = searchString;
+	}
+}

Property changes on: D:\workspaces\hibernate-ganymede\HibernateExt\tools\src\test\org\hibernate\tool\hbm2x\hbm2hbmxml\Search.java
___________________________________________________________________
Name: svn:mime-type
   + text/plain
Name: svn:keywords
   + Author Id Revision Date
Name: svn:eol-style
   + native

Index: D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/Search.hbm.xml
===================================================================
--- D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/Search.hbm.xml	(revision 0)
+++ D:/workspaces/hibernate-ganymede/HibernateExt/tools/src/test/org/hibernate/tool/hbm2x/hbm2hbmxml/Search.hbm.xml	(revision 0)
@@ -0,0 +1,21 @@
+<?xml version="1.0"?>
+<!DOCTYPE hibernate-mapping PUBLIC 
+	"-//Hibernate/Hibernate Mapping DTD 3.0//EN"
+	"http://hibernate.sourceforge.net/hibernate-mapping-3.0.dtd">
+
+<!--
+  
+-->
+
+<hibernate-mapping package="mapping.sorted">
+	
+	<class name="Search">
+		<id name="searchString"/>
+		<set name="searchResults" sort="natural">
+			<key column="searchString"/>
+			<element column="text" type="string"/>
+		</set>
+	</class>
+	
+</hibernate-mapping>
+

Property changes on: D:\workspaces\hibernate-ganymede\HibernateExt\tools\src\test\org\hibernate\tool\hbm2x\hbm2hbmxml\Search.hbm.xml
___________________________________________________________________
Name: svn:mime-type
   + text/xml
Name: svn:eol-style
   + native

